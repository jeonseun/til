# 데이터 모델링

데이터 모델링에 관한 개념 정리

## TOC

- [데이터 모델링과 데이터 모델](#데이터-모델링과-데이터-모델)
  - [개념적 모델링, 개념적 데이터 모델](#개념적-모델링-개념적-데이터-모델)
  - [논리적 모델링, 논리적 데이터 모델](#논리적-모델링-논리적-데이터-모델)
  - [데이터 모델 구성](#데이터-모델-구성)
- [개체 관계 모델](#개체-관계-모델)
  - [개체](#개체)
  - [속성](#속성)
    - [개수에 따른 속성 구분](#개수에-따른-속성-구분)
    - [의미분해에 따른 속성 구분](#의미분해에-따른-속성-구분)
    - [유도 속성](#유도-속성)
    - [널 속성](#널-속성)
    - [키 속성](#키-속성)
  - [관계](#관계)
    - [관계 구분](#관계-구분)
    - [관계의 참여 특성](#관계의-참여-특성)
    - [관계의 종속성](#관계의-종속성)
  - [ERD 예제](#ERD-예제)
- [관계 데이터 모델](#관계-데이터-모델)
  - [릴레이션 구성](#릴레이션-구성)
  - [릴레이션 스키마, 인스턴스](#릴레이션-스키마-인스턴스)
  - [릴레이션 특성](#릴레이션-특성)
  - [키](#키)
    - [슈퍼키](#슈퍼키)
    - [후보키](#후보키)
    - [기본키](#기본키)
    - [대체키](#대체키)
    - [외래키](#외래키)
    - [대리키](#대리키)
  - [관계 데이터 모델 제약조건](#관계-데이터-모델-제약조건)
    - [개체 무결성 제약조건](#개체-무결성-제약조건)
    - [참조 무결성 제약조건](#참조-무결성-제약조건)

<br>

## 데이터 모델링과 데이터 모델

현실 세계의 데이터를 컴퓨터 데이터베이스에 저장하기 위한 변환 과정을 데이터 모델링(data modeling)이라 하며 그 과정에서 저장할 데이터를 추출하는 작업을 추상화(abstraction)라 한다. 그리고 이러한 데이터 모델링의 결과물을 표현하는 도구가 데이터 모델(data model)이다.

### 개념적 모델링, 개념적 데이터 모델

- 개념적 모델링(conceptual modeling) → 현실 세계의 주요 데이터를 추출하여 개념 세계로 옮기는 작업
- 개념적 데이터 모델(conceptual data model) → 사람이 이해할 수 있도록 현실 세계의 데이터를 데이터베이스의 개념적 구조로 표현하는 도구

### 논리적 모델링, 논리적 데이터 모델

- 논리적 모델링(logical modeling) → 개념 세계의 데이터를 데이터베이스에 저장하기 위한 구조를 결정하고 표현하는 작업
- 논리적 데이터 모델(logical data model) → 개념적 구조를 데이터베이스의 논리적 구조(데이터베이스 스키마)로 표현하는 도구

### 데이터 모델 구성

- 데이터 구조(data structure)
  - 추상화된 데이터가 어떤 요소로 이루어져 있는지 표현(개념적 데이터 모델)
  - 데이터를 어떤 모습으로 저장할 것인지에 대한 표현(논리적 데이터 모델)
- 연산(operation) → 데이터 구조에 따라 표현된 실제 값들을 처리하는 작업
- 제약조건(constraint) → 데이터 무결성 유지를 위한 제약사항

<br>

## 개체 관계 모델

개체 관계 모델(entity relationship model)은 개체와 개체 간의 관계을 이용해 현실 세계의 데이터를 개념적 구조로 표현하는 개념적 데이터 모델이며 개체 관계 모델링을 그림으로 표현한 것을 개체 관계 다이어그램(ERD, entity relationship diagram)이라 한다. 아래에서 설명하는 ERD는 peter chen 방식이며 개념적 데이터 모델링과 논리적 데이터 모델링에 모두 쓰인다.

### 개체

개체(entity)는 저장할 가치가 있는 데이터를 가진, 구별되는 모든것을 의미하며 사람이나 사물처럼 물리적으로 존재하는 것 또는 개념이나 사건처럼 개념적으로 존재하는 것이 개체가 된다.

![entity](../resources/images/database/데이터%20모델링/entity.svg)

- 개체는 고유한 이름을 가짐
- 개체의 고유한 특성이나 상태(속성)를 가짐
- 개체 타입(entity type)은 개체의 이름과 속성으로 정의됨
- 개체 인스턴스(entity instance)는 개체를 구성하는 속성이 실제 값으로 실체화된 것
- 개체 집합(entity set)은 개체 인스턴스를 모아둔 것이며 데이터베이스에 실제로 저장하여 관리하는 것에 해당함
- ERD에서 개체는 사각형으로 표현하며 사각형 내에 개체의 고유한 이름을 표기

### 속성

속성(attribute)는 개체가 가지고 있는 고유한 특성을 말하며 의미를 가지는 데이터의 가장 작은 논리적 단위이다. ERD에서 일반적인 속성은 타원으로 표현하며 타원 내에 속성의 이름을 표기하고 개체와 선으로 연결된다.

![attribute](../resources/images/database/데이터%20모델링/attribute.svg)

#### 개수에 따른 속성 구분

속성은 개수에 따라 단일 값 속성(single valued attribute)과 다중 값 속성(multi valued attribute)으로 구분할 수 있다.

- 단일 값 속성 → 하나의 개체 인스턴스에 대해 하나의 값만 가지는 일반적인 속성
- 다중 값 속성 → 하나의 개체 인스턴스에 대해 여러개의 값을 가지는 속성, ERD에서 이중 타원으로 표현하며 타원 내에 속성의 이름을 표기  
   ![multi-valied attribute](../resources/images/database/데이터%20모델링/multi%20valued%20attribute.svg)

#### 의미분해에 따른 속성 구분

속성은 의미분해 가능여부에 따라 단순 속성(simple attribute)과 복합 속성(composite attribute)으로 구분할 수 있다.

- 단순 속성 → 의미를 더 이상 분해할 수 없는 값의 의미가 하나인 속성, ERD에서 일반적인 속성과 같은 방식으로 표현
- 복합 속성 → 의미를 분해할 수 있어 값이 여러 개의 의미를 포함하는 속성, ERD에서 하나의 속성에 다른 속성이 선으로 연결된 형태로 표기  
  ![composite attribute](../resources/images/database/데이터%20모델링/composite%20attribute.svg)

#### 유도 속성

기존 속성값으로 부터 유도되는 속성일 경우 유도 속성(derived attribute)이라 하며 상대적인 개념으로 유도 속성을 계산하는데 쓰이는 속성을 저장 속성(stored attribute)이라 한다.

- 유도 속성 → 필요할 때마다 저장 속성의 값으로 부터 계산되어 결정되는 속성, 별도로 저장해두지 않음, ERD에서 점선 타원으로 표현  
  ![derived attribute](../resources/images/database/데이터%20모델링/derived%20attribute.svg)
- 저장 속성 → 유도 속성 계산에 쓰이는 속성, 값을 저장해두고 있음, ERD에서 일반적인 속성과 같은 방식으로 표현

#### 널 속성

널(null)값은 아직 결정되지 않았거나 모르는 값을 의미하며 이러한 널값을 허용하는 속성을 널 속성(null attribute)이라 한다.

#### 키 속성

키 속성(key attribute)은 속성들 중에서 각 개체를 구분하기 위해 사용되는 속성이다.

![key attribute](../resources/images/database/데이터%20모델링/key%20attribute.svg)

- 키 속성은 개체 집합에 존재하는 개체 인스턴스의 식별에 사용되므로 서로 달라야함
- 키 속성은 둘 이상의 속성으로 구성되기도 함
- ERD에서 속성 이름에 밑줄을 그어 표기함

### 관계

관계(relationship)는 개체 집합 사이의 대응 관계를 말한다.

![relationship](../resources/images/database/데이터%20모델링/relationship.svg)

- 관계 타입(relationship type)은 개체들의 관계에서 정의됨
- 관계도 속성을 가질 수 있음
- 관계 인스턴스(relationship instance)는 개체 인스턴스 간의 실체화된 관계를 말함
- ERD에서 마름모로 표기하며 개체와 선으로 연결됨

#### 관계 구분

관계는 참여하는 개체의 수 또는 매핑 카디널리티(mapping cardinality)에 따라 구분할 수 있다. 매핑 카디널리티는 연관된 두 개체 집합에서 각 개체 인스턴스가 상대 개체 집합에 대해 연관성을 가지는 개체 인스턴스의 수를 말한다.

참여하는 개체의 수에 따른 구분

- 이항 관계 → 2개의 개체 타입이 관계를 맺음
- 삼항 관계 → 3개의 개체 타입이 관계를 맺음
- 순환 관계 → 개체 타입 1개가 자기 자신과 관계를 맺음

개체 A, B가 관계로 연결될 때 매핑 카디널리티에 따른 구분

- 1:1 → A의 개체 인스턴스가 B의 개체 인스턴스 하나와 관계를 맺으며 그 반대도 동일
- 1:N → A의 개체 인스턴스가 B의 개체 인스턴스 여러개와 관계를 맺으며 B의 개체 인스턴스는 A의 개체 인스턴스 하나와만 관계를 맺음
- N:M → A의 개체 인스턴스가 B의 개체 인스턴스 여러개와 관계를 맺으며 그 반대도 동일

매핑 카디널리티에 의해 관계를 구분할 때는 참여하는 개체 인스턴스의 수를 개체를 연결하는 선에 라벨로 표기한다.

![mapping cardinality](../resources/images/database/데이터%20모델링/mapping%20cardinality.svg)

_1:N 관계에 대한 ERD_

#### 관계의 참여 특성

두 개체의 관계에서 개체 인스턴스가 관계에 참여하는 것에 따라 필수적 참여와 선택적 참여로 구분할 수 있다. 관계의 참여 특성은 데이터베이스를 운영할 때 개체 인스턴스의 삽입, 삭제, 수정등에서 제약 사항으로도 활용된다.

개체 A, B가 관계를 맺고 있을 때 관계의 참여 특성은 다음과 같다.

- 선택적 참여 → A의 일부 개체 인스턴스가 B의 개체 인스턴스와 관계를 맺는 경우 A는 관계에 선택적 참여, ERD에서 일반적인 관계와 같은 방식으로 표현함
- 필수적 참여 → A의 모든 개체 인스턴스가 B의 개체 인스턴스와 관계를 맺는 경우 A는 관계에 필수적 참여, ERD에서 이중선으로 표현함

![essential participation](../resources/images/database/데이터%20모델링/essential%20participation%20.svg)

_환자는 반드시 전담하는 의사가 있어야 함을 뜻함_

#### 관계의 종속성

두 개체 A, B의 관계에서 B가 혼자서는 존재할 수 없고 A의 존재여부에 종속적이라면 B는 A에 종속되어 있다고 한다. 이는 A가 제거될 경우 B도 함께 제거되어야 함을 의미하며 이를 존재 종속(existence dependence)이라고 한다.

종속성이 있는 관계에서 개체는 다음 두 가지로 구분할 수 있다.

- 약한 개체(weak entity) → 다른 개체의 존재 여부에 의존적인 개체
- 강한 개체(strong entity) → 다른 개체의 존재 여부를 결정하는 개체

개체 간 종속성의 특징

- 강한 개체와 약한 개체는 일반적으로 1:N 관계
- 약한 개체는 강한 개체와의 관계에 필수적 참여
- 약한 개체는 자신의 속성만으론 식별이 어려워 강한 개체의 키를 포함하여 키 구성, 약한 개체를 식별하기 위한 속성은 부분키(partial key)라고 함
  - 강한 개체의 키를 가져와서 약한 개체의 키를 구성하는 경우 식별 관계(identifying relation)
  - 약한 개체의 속성만으로 키를 구성하는 경우 비식별 관계(non identifying relation), 이 경우 약한 개체는 데이터베이스의 제약조건으로 강한 개체에 종속시키지 못함
- ERD에서 강한 개체에 종속되는 약한 개체는 이중 사각형으로, 약한 개체가 강한 개체와 맺는 식별 관계는 이중 마름모로 표현한다. 약한 개체의 경우 관계에 필수적 참여하므로 이중선을 통해 연결된다.

![dependence](../resources/images/database/데이터%20모델링/dependence.svg)

_댓글은 연결된 게시글이 반드시 있어야 하며 게시글이 제거되면 댓글도 같이 제거됨을 뜻함_

<br>

## 관계 데이터 모델

관계 데이터 모델은 논리적 데이터 모델중 하나로 데이터베이스의 논리적 구조를 2차원 테이블 형태로 표현하며 주로 관계형 데이터베이스 관리 시스템에서 사용된다. 관계 데이터 모델에서 개체는 테이블 형태인 하나의 릴레이션(relation)으로 표현된다.

### 릴레이션 구성

릴레이션은 릴레이션 스키마(relation schema)와 릴레이션 인스턴스(relation instance)로 구성된다.

![relation structure](../resources/images/database/데이터%20모델링/relation-structure.svg)

- 릴레이션 스키마 → 릴레이션의 논리적 구조를 나타내며 릴레이션 이름과 릴레이션의 모든 속성으로 구성
- 릴레이션 인스턴스 → 한 시점에 릴레이션에 존재하는 모든 튜플의 집합 즉 개체 인스턴스의 집합, 릴레이션 스키마에 정의된 속성에 대응하는 실제 값으로 구성됨

데이터베이스 관점에서 릴레이션 스키마와 인스턴스는 다음과 같이 대응된다.

- 데이터베이스 스키마 → 모든 릴레이션 스키마의 집합
- 데이터베이스 인스턴스 → 한 시점에 존재하는 모든 릴레이션 인스턴스의 집합

### 릴레이션 스키마, 인스턴스

![relation](../resources/images/database/데이터%20모델링/relation.svg)

릴레이션 스키마를 구성하는 속성과 관련된 개념

- 속성(attribute) → 릴레이션의 열(column), 각 속성은 한 릴레이션 내에서 고유한 이름을 가짐
- 도메인(domain) → 속성 하나가 가질 수 있는 모든 값의 집합, 관계 데이터 모델에서는 원자 값만 속성 값으로 쓸 수 있으므로 도메인은 속성이 가질 수 있는 원자 값의 모임이라고 할 수 있음
- 널 값(null value) → 릴레이션의 특정 튜플의 속성 값을 모르거나 적합한 값이 없는 경우를 나타내는 값
- 차수(degree) → 한 릴레이션의 전체 속성 개수, 릴레이션은 최소 1이상의 차수를 유지해야함, 변경이 적음

릴레이션 인스턴스를 구성하는 튜플과 관련된 개념

- 튜플(tuple) → 릴레이션의 행(row), 속성에 대한 실제 값, 개체 인스턴스를 나타냄
- 카디널리티(cardinality) → 한 릴레이션의 전체 튜플 개수, 변경이 잦음

### 릴레이션 특성

테이블이 릴레이션이 되기 위해 만족해야하는 특성

튜플의 유일성

- 한 릴레이션의 모든 튜플에는 다른 튜플과 구별되는 유일한 특성이 있어야 함
- 하나 또는 여러 개의 속성(키 속성)을 미리 정해두고 튜플마다 다르도록 하여 튜플의 유일성 판단

튜플의 무순서

- 한 릴레이션에서 튜플 사이의 순서는 무의미
- 튜플의 순서가 바뀌어도 값이 같다면 같은 릴레이션

속성의 무순서

- 한 릴레이션에서 속성 사이의 순서는 무의미
- 속성의 순서와 상관없이 같은 속성으로 구성된다면 같은 릴레이션

속성의 원자성

- 모든 속성 값은 원자 값만 가질 수 있음
- 즉 속성에는 다중값을 허용하지 않음

### 키

키(key)는 릴레이션에 포함된 튜플들을 서로 구별해주는 속성을 말한다.

#### 슈퍼키

- 슈퍼키(super key)는 유일성을 만족하는 속성 또는 속성 집합
- 튜플 간에 중복되지 않는 속성이 포함될 경우 슈퍼키가 됨
- 모든 속성의 집합도 슈퍼키가 됨
- 단 식별을 위한 속성 이외의 속성이 키에 포함될 경우 비효율적임

#### 후보키

- 후보키(candidate key)는 유일성과 최소성을 만족하는 속성 또는 속성 집합
- 식별을 위해 반드시 필요한 속성으로만 구성된 키
- 슈퍼키 중에서 식별을 위해 필요한 속성으로만 구성된 키는 후보키가 됨

#### 기본키

기본키(primary key)는 후보키 중에서 기본적으로 사용할 키를 말하며 기본키를 선택하는 기준은 다음과 같다.

- 널 값을 가질 수 있으면 부적합, 튜플 끼리 구별하는데 문제 발생
- 값의 변경이 잦은 경우 부적합, 속성 값이 바뀔 때 마다 검증과정 필요
- 단순한 후보키가 적합
  - 단순 문자열이나 자릿수가 적은 정수 또는 후보키중 속성의 개수가 적은 것
  - 단순한 후보키를 쓰는 것을 데이터베이스 사용자와 더불어 컴퓨터 시스템도 선호함

#### 대체키

대체키(alternate key)는 후보키 중 기본키가 되지 못한 키를 말한다.

#### 외래키

외래키(foreign key)는 특정 릴레이션에 속성 또는 속성 집합이 다른 릴레이션의 기본키가 되는 키를 말한다. 즉 다른 릴레이션의 기본키를 참조하는 속성 집합이 외래키가 된다. 외래키는 릴레이션 간의 관계를 올바르게 표현하기 위해 필요하다.

참조여부에 따른 릴레이션 구분

- 참조하는 릴레이션 → 외래키를 가진 릴레이션
- 참조되는 릴레이션 → 기본키를 가지고 있으며 다른 릴레이션이 참조하는 릴레이션

외래키의 특성

- 외래키는 반드시 릴레이션의 기본키를 참조해야 함
- 외래키 속성과 참조되는 기본키 속성의 이름은 달라도 됨
- 외래키 속성의 도메인과 참조되는 기본키 속성의 도메인은 같아야 함
- 한 릴레이션에 여러개의 외래키가 존재할 수 있음
- 외래키를 릴레이션의 기본키로 사용하거나 외래키를 포함해서 기본키를 구성할 수 있음
- 외래키는 같은 릴레이션 내의 기본키를 참조할 수도 있음

#### 대리키

대리키(surrogate key) 일련번호 처럼 가상의 속성을 생성하여 기본키로 사용하는 것을 말하며 기본키가 보안에 중요한 속성을 포함하거나 여러 속성으로 구성되어 복잡한 경우 또는 기본키에 적합한 속성이 없는 경우 사용한다.

대리키 사용의 장점

- 단순한 값의 사용으로 데이터 연산 속도가 향상됨
- 중요 데이터의 노출 위험을 낮춤
- 변경이 용이함

### 관계 데이터 모델 제약조건

관계 데이터 모델 제약조건은 데이터를 무결성을 보장하기 위한 규칙을 말하며 개체 무결정 제약조건과 참조 무결성 제약조건으로 구분할 수 있다. 이러한 제약조건은 데이터베이스에 데이터가 삽입, 삭제, 수정 되어 상태가 변해도 지켜져야 한다.

#### 개체 무결성 제약조건

- 개체 무결성 제약조건(entity integrity constraint)은 기본키를 구성하는 속성은 널 값을 가지면 안되는 것을 의미
- 기본키를 구성하는 속성 전체 또는 일부가 널일 경우 튜플의 유일성 판단이 불가능하므로 기본키의 본 목적을 상실
- 튜플이 추가되거나 변경되는 연산에서 기본키에 널 값이 포함되는지 확인하는 과정이 필요함, 이 과정은 데이터베이스 관리 시스템이 자동으로 처리

#### 참조 무결성 제약조건

- 참조 무결성 제약조건(reference integrity constraint)은 외래키는 참조할 수 없는 값을 가질 수 없음을 의미
- 외래키는 참조하는 릴레이션에 기본키 값을 참조해야 함, 즉 참조 가능한 값만 값으로 가능
- 참조가능한 값 뿐만아니라 참조하는 대상이 지정되지 않은 널 값도 외래키의 값으로 사용 가능
- 릴레이션 생성 시 외래키와 참조 대상이 되는 다른 릴레이션의 기본키를 지정해두면 데이터베이스 상태 변경 시 데이터베이스 관리 시스템이 자동으로 참조 무결성 제약조건을 지키도록 처리함

<br>

## References

- [데이터베이스 개론 3판 #ch4 ~ ch5 - 김연희, 한빛출판네트워크](https://www.hanbit.co.kr/store/books/look.php?p_code=B6505632990)
