# 클래스의 정적 멤버

클래스의 정적 멤버 개념 정리

## TOC

- [인스턴스 멤버 vs 정적 멤버](#인스턴스-멤버-vs-정적-멤버)
- [정적 필드 선언](#정적-필드-선언)
- [정적 필드 초기화](#정적-필드-초기화)
  - [정적 초기화 블록](#정적-초기화-블록)
- [정적 메서드 정의](#정적-메서드-정의)
  - [정적 메서드 예시](#정적-메서드-예시)
- [import static](#import-static)
- [메모리 관점의 정적 멤버 vs 인스턴스 멤버](#메모리-관점의-정적-멤버-vs-인스턴스-멤버)
- [정적 멤버의 접근 범위](#정적-멤버의-접근-범위)

<br>

## 인스턴스 멤버 vs 정적 멤버

클래스의 멤버는 크게 인스턴스 멤버(instance member)와 정적 멤버(static member)로 구분할 수 있다. 인스턴스 멤버는 객체별로 할당되며 각 객체의 특성을 나타낸다. 반면에 정적 멤버는 클래스 단위로 할당되며 해당 클래스의 모든 인스턴스들이 공유하는 특성을 나타낸다.

인스턴스 멤버

- 인스턴스 멤버는 객체마다 개별적으로 존재
- 인스턴스 멤버 중 필드(인스턴스 변수)는 객체가 생성될 때 함께 생성, 초기화되며 객체마다 독립적
- 인스턴스 멤버 중 메서드(인스턴스 메서드)는 해당 객체에 대한 작업을 수행
- 인스턴스 멤버는 생성된 객체를 통해 접근

정적 멤버

- 정적 멤버는 클래스별로 하나씩만 존재
- 정적 멤버는 클래스 로딩 시 생성, 초기화되며 해당 클래스의 모든 인스턴스가 공유
- 정적 멤버는 클래스 이름을 통해 접근

<br>

## 정적 필드 선언

정적 필드(static field)는 클래스의 필드 중 `static` 키워드가 붙은 것으로 해당 클래스의 모든 인스턴스가 공유하는 필드이다. 클래스의 인스턴스 수에 관계없이(0개 포함) 단 하나만 생성되며 클래스 자체에 속하는 변수라는 뜻에서 클래스 변수라고도 한다.

```java
class A {
    static 필드타입 필드이름;
}
```

`Counter` 클래스가 몇번 인스턴스화 되었는지 확인하기 위해 정적 필드 사용하기

- 인스턴스의 수를 나타낼 정적 필드 선언
- 인스턴스화 될 때마다 해당 필드의 값을 증가
- 정적 필드값에 접근하기 위한 메서드 제공

```java
public class Counter {

    static int instanceCount; // 생성된 인스턴스 수를 나타내는 정적 필드

    public Counter() {
        instanceCount++; // 인스턴스화 될 때마다 1씩 증가
    }
}
```

```java
public class CounterMain {

    public static void main(String[] args) {
        Counter instance1 = new Counter(); // instanceCount -> 1
        Counter instance2 = new Counter(); // instanceCount -> 2
        Counter instance3 = new Counter(); // instanceCount -> 3

        System.out.println(Counter.instanceCount); // 3, Counter 클래스 이름으로 접근
    }
}
```

<br>

## 정적 필드 초기화

정적 필드도 인스턴스 변수처럼 선언과 동시에 초기값을 할당하는 식으로 초기화할 수 있다. 단 인스턴스 변수의 필드 초기화 방식은 객체가 생성될 때마다 적용되지만 정적 필드는 클래스 로딩 시점에 한번만 초기화된다.

```java
class A {
    static int staticField = 10;
}
```

> 정적 필드 초기값
>
> 정적 필드도 인스턴스 변수와 마찬가지로 초기화하지 않을 경우 지정된 기본값이 할당된다. 이 값은 필드에 적용되는 기본값과 동일하다.

### 정적 초기화 블록

정적 필드의 초기화가 한줄 이상의 코드를 필요로 하는 경우 정적 초기화 블록(static initialization block)을 고려할 수 있다. 정적 초기화 블록에는 정적 필드에 대한 초기화 코드를 삽입할 수 있다.

```java
class A {
    static int staticField;

    // 정적 초기화 블록
    static {
        Random rand = new Random();
        staticField = rand.nextInt(); // 난수로 정적 필드를 초기화하기
    }
}
```

정적 초기화 블록 특징

- 정적 초기화 블록은 클래스 로딩 시점에 실행
- 정적 초기화 블록은 클래스 내 어느 위치에 나타나도 무관
- 정적 초기화 블록은 1개 이상 선언가능
- 여러개의 정적 초기화 블록이 선언된 경우 소스코드에 나타나는 순서대로 실행
- 정적 필드 선언 시 할당 연산으로 초기화하고 정적 초기화 블록까지 사용한 경우 정적 초기화 블록의 코드가 적용

<br>

## 정적 메서드 정의

정적 메서드(static method)는 `static` 키워드가 붙은 메서드로 객체 생성없이 바로 사용할 수 있는 메서드다. 인스턴스 메서드와는 달리 객체의 상태와 관련된 동작을 할 수는 없지만 상태에 영향을 받지 않는 순수한 기능을 제공하는 용도 또는 클래스 내에서만 사용되는 기능 중 객체의 상태와 관련없는 기능을 정의하는데 사용할 수 있다.

```java
class A {
    static 반환타입 메서드이름(매개변수 목록) {
        ...
        return xxx; // 반환값이 있는 경우
    }
}
```

정수 배열의 모든 요소 합을 계산해주는 정적 메서드

```java
class ArrayUtil {
    public static int sum(int[] arr) {
        int sum = 0;
        for (int num : arr) {
            sum += num;
        }

        return sum;
    }
}
```

클래스 이름을 통해 접근해서 정적 메서드를 호출

```java
public class ArrayUtilMain {

    public static void main(String[] args) {
        int[] nums = {1, 2, 3, 4, 5};

        System.out.println(ArrayUtil.sum(nums));
    }
}
```

### 정적 메서드 예시

정적 메서드는 유틸리티성 메서드를 정의하는데 많이 사용된다. 대표적으로 자바 API 중 수학 관련 클래스인 `java.lang.Math` 에 정의된 메서드들은 모두 정적 메서드다.

```java
// java.lang.Math 클래스 일부
public final class Math {
    ...
    public static double ceil(double a) { ... }

    public static double floor(double a) { ... }

    public static double pow(double a, double b) { ... }
    ...
}
```

`Math` 클래스의 메서드들은 정적 메서드이므로 다음과 같이 클래스 이름을 통해 접근해서 호출할 수 있다.

```java
public class StaticMethodCall {

    public static void main(String[] args) {
        double pow = Math.pow(3.0, 4.0); // Math 클래스 이름에 . 연산자로 접근 후 정적 메서드 호출
        System.out.println(pow); // 81.0
    }
}
```

> 정적 멤버 접근 시 주의사항
>
> 정적 필드와 정적 메서드는 클래스 이름 뿐 아니라 객체를 통해서도 접근할 수 있다. 단 해당 멤버가 정적 멤버라는 것을 명확하게 하기위해 클래스 이름으로 접근하는 것이 권장된다.

<br>

## import static

정적 멤버 사용할 때는 `클래스이름.정적멤버` 로 접근해야 하지만 `import static` 을 사용하면 정적 멤버의 이름만 가지고 접근할 수 있다. 이를 잘 활용하면 코드의 가독성을 높일 수 있다.

```java
import static FQCN.정적멤버; // 해당 클래스의 특정 정적 멤버만 import
import static FQCN.*;      // 해당 클래스 내 모든 정적 멤버 import
```

`java.lang.Math` 클래스의 `floor()` 와 `PI` 를 `import static` 으로 추가해서 사용하면 다음과 같다.

```java
import static java.lang.Math.floor;
import static java.lang.Math.PI;

public class StaticImport {

    public static void main(String[] args) {
        floor(3.14);            // Math.floor();
        System.out.println(PI); // Math.PI
    }
}
```

`import static` 주의사항

- 서로 다른 클래스의 정적 멤버가 이름이 같은 경우 다른 하나는 FQCN을 적고 써야함
- `import static` 을 과하게 사용할 경우 어떤 클래스의 정적 멤버인지 구분하기 어려워지므로 주의

> FQCN이란?
>
> FQCN은 Fully Qualified Class Name의 줄임말로 전체 패키지 경로를 포함하는 클래스 이름을 뜻한다. 예를들어 `String`, `Math` 등의 FQCN은 `java.lang.String`, `java.lang.Math` 가 된다.

<br>

## 메모리 관점의 정적 멤버 vs 인스턴스 멤버

정적 멤버과 인스턴스 멤버는 JVM 내에서 서로 다른 메모리 공간에 저장되며 몇 가지 차이점이 있다.

정적 멤버

- JVM내 메서드 영역(method area)에 클래스 당 1개만 저장
  - 메서드 영역은 클래스 관련 정보들이 저장되는 영역으로 필드, 메서드, 생성자 등이 저장됨
- 클래스 로딩부터 메서드 영역에 존재하며 JVM 종료시까지 유지됨

인스턴스 멤버(특히 인스턴스 변수)

- JVM내 힙 영역(heap area)에 객체 당 1개씩 저장
  - 힙 영역은 생성된 객체들이 저장되는 영역
- 객체 생성부터 힙 영역에 존재하며 객체가 GC에 의해 제거될 때까지 유지됨

> 인스턴스 메서드 저장위치
>
> 인스턴스 변수와 달리 인스턴스 메서드는 정적 멤버과 함께 메서드 영역에 저장된다. 이는 다른 객체라해도 같은 메서드 코드를 사용하기 때문에 굳이 여러개를 저장할 필요가 없기 때문이다. 단 저장위치만 같을 뿐 다른 멤버에 대한 접근에서 차이점이 존재한다.

<br>

## 정적 멤버의 접근 범위

정적 멤버는 다른 정적 멤버에는 접근할 수 있지만 인스턴스 멤버에는 접근하지 못한다. 이는 정적 멤버의 초기화 매커니즘과 관련이 있는데 정적 멤버가 초기화되는 시점은 클래스 로딩 시점이지 객체의 생성 시점이 아니다. 따라서 이때는 인스턴스 멤버 자체가 존재하지도 않으며 있다해도 어떤 대상을 참조할지도 문제다. 따라서 자바에서는 컴파일 단계에서 이러한 접근을 막는다. 반대로 인스턴스 멤버들은 자유롭게 정적 멤버에 접근할 수 있다.

정적 필드 초기화, 정적 초기화 블록, 정적 메서드에서 제한되는 것

- `this`, `super` 참조 사용 불가능
- 인스턴스 변수 접근 및 인스턴스 메서드 호출 금지

```java
class A {
    static int staticField = instanceField; // 컴파일 에러!

    int instanceField = 10;

    static {
        this.instanceField; // 컴파일 에러!
        super.equals();     // 컴파일 에러!
        instanceMethod();   // 컴파일 에러!
    }

    static void staticMethod() {
        instanceMethod(); // 컴파일 에러!
    }

    void instanceMethod() { ... }
}
```

<br>

## References

- [김영한의 실전 자바 - 기본편 - 김영한, Inflearn](https://www.inflearn.com/course/%EA%B9%80%EC%98%81%ED%95%9C%EC%9D%98-%EC%8B%A4%EC%A0%84-%EC%9E%90%EB%B0%94-%EA%B8%B0%EB%B3%B8%ED%8E%B8)
- [More on Classes - Dev.java](https://dev.java/learn/classes-objects/more-on-classes/)
- [Java Language Specification se21 #ch8 - Oracle](https://docs.oracle.com/javase/specs/jls/se21/html/jls-8.html)

<br>

## Tags

- java
- class
- static
